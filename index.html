<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Screen App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }

        .screen {
            position: fixed;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .screen.active {
            display: flex;
        }

        /* Стили для приветственного экрана */
        .welcome-text {
            font-size: 2em;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 2em;
            animation: fadeIn 2s ease;
        }

        .main-button {
            padding: 15px 40px;
            font-size: 1.2em;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }

        .main-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Стили для профиля */
        .profile-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 60px;
            margin-bottom: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .profile-name {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .profile-id {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 20px;
        }

        /* Стили для редактора изображений */
        .editor-container {
            width: 90%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
        }

        .image-preview {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 10px;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .upload-button {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            cursor: pointer;
            margin: 10px 0;
        }

        #imageInput {
            display: none;
        }

        .pixel-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .pixel-button {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        /* Стили для новостей */
        .news-screen {
            padding-top: 60px;
        }

        .news-categories {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-x: auto;
        }

        .category-button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
        }

        .category-button.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .news-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
        }

        .news-article {
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
        }

        .news-article img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 10px 0;
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Снежинки */
        .snowflake {
            position: fixed;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Экран приветствия -->
    <div class="screen welcome-screen active" id="welcomeScreen">
        <h1 class="welcome-text">Welcome to the App</h1>
        <button class="main-button" onclick="showScreen('profileScreen')">Next</button>
    </div>

    <!-- Экран профиля -->
    <div class="screen profile-screen" id="profileScreen">
        <div class="profile-container">
            <img class="profile-photo" src="" alt="Profile Photo">
            <div class="profile-name"></div>
            <div class="profile-id"></div>
            <button class="main-button" onclick="showScreen('imageEditorScreen')">Continue</button>
        </div>
    </div>

    <!-- Экран редактора изображений -->
    <div class="screen image-editor-screen" id="imageEditorScreen">
        <div class="editor-container">
            <div class="image-preview">
                <img id="uploadedImage" src="" alt="Upload Image">
            </div>
            <input type="file" id="imageInput" accept="image/*">
            <label for="imageInput" class="upload-button">Upload Image</label>
            
            <div class="pixel-controls">
                <button class="pixel-button" data-effect="light">Light Pixel</button>
                <button class="pixel-button" data-effect="medium">Medium Pixel</button>
                <button class="pixel-button" data-effect="heavy">Heavy Pixel</button>
            </div>
            
            <button class="main-button" onclick="showScreen('newsScreen')">Continue to News</button>
        </div>
    </div>

    <!-- Экран новостей -->
    <div class="screen news-screen" id="newsScreen">
        <div class="news-categories">
            <button class="category-button active" data-category="crypto">Cryptocurrency</button>
            <button class="category-button" data-category="programming">Programming</button>
            <button class="category-button" data-category="tech">Technology</button>
        </div>
        
        <div class="news-container" id="newsContainer">
            <!-- Новости будут добавляться динамически -->
        </div>
    </div>
  <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Создание снежинок для приветственного экрана
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.style.width = Math.random() * 4 + 2 + 'px';
            snowflake.style.height = snowflake.style.width;
            snowflake.style.left = Math.random() * window.innerWidth + 'px';
            snowflake.style.opacity = Math.random();
            document.body.appendChild(snowflake);

            let posY = -10;
            function fall() {
                if (posY >= window.innerHeight) {
                    document.body.removeChild(snowflake);
                    return;
                }
                posY += 1;
                snowflake.style.top = posY + 'px';
                requestAnimationFrame(fall);
            }
            fall();
        }

        // Генерация снежинок
        setInterval(createSnowflake, 100);

        // Управление экранами
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'profileScreen') {
                loadProfileData();
            } else if (screenId === 'newsScreen') {
                loadNews('crypto');
            }
        }

        // Загрузка данных профиля
        function loadProfileData() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.querySelector('.profile-name').textContent = 
                    user.first_name + (user.last_name ? ' ' + user.last_name : '');
                document.querySelector('.profile-id').textContent = 'ID: ' + user.id;
                
                if (user.photo_url) {
                    document.querySelector('.profile-photo').src = user.photo_url;
                } else {
                    document.querySelector('.profile-photo').src = 'https://via.placeholder.com/120';
                }
            }
        }

        // Обработка загрузки изображения
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('uploadedImage');
                    img.src = e.target.result;
                    img.onload = function() {
                        // Сохраняем оригинальное изображение для обработки
                        window.originalImage = img;
                    }
                }
                reader.readAsDataURL(file);
            }
        });

        // Функция пикселизации изображения
        function pixelateImage(img, pixelSize) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Устанавливаем размеры canvas
            canvas.width = img.width;
            canvas.height = img.height;
            
            // Рисуем оригинальное изображение
            ctx.drawImage(img, 0, 0, img.width, img.height);
            
            // Получаем данные изображения
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // Проходим по всем пикселям с заданным шагом
            for (let y = 0; y < canvas.height; y += pixelSize) {
                for (let x = 0; x < canvas.width; x += pixelSize) {
                    // Получаем цвет первого пикселя в блоке
                    const red = data[((y * canvas.width + x) * 4)];
                    const green = data[((y * canvas.width + x) * 4) + 1];
                    const blue = data[((y * canvas.width + x) * 4) + 2];
                    
                    // Закрашиваем весь блок этим цветом
                    ctx.fillStyle = `rgb(${red},${green},${blue})`;
                    ctx.fillRect(x, y, pixelSize, pixelSize);
                }
            }
            
            return canvas.toDataURL();
        }

        // Обработка эффектов пикселизации
        document.querySelectorAll('.pixel-button').forEach(button => {
            button.addEventListener('click', function() {
                if (!window.originalImage) return;
                
                const effect = this.dataset.effect;
                let pixelSize;
                
                switch(effect) {
                    case 'light':
                        pixelSize = 5;
                        break;
                    case 'medium':
                        pixelSize = 10;
                        break;
                    case 'heavy':
                        pixelSize = 20;
                        break;
                }
                
                const pixelatedDataUrl = pixelateImage(window.originalImage, pixelSize);
                document.getElementById('uploadedImage').src = pixelatedDataUrl;
            });
        });

        // Загрузка новостей
        function loadNews(category) {
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';

            // Демо-данные новостей
            const newsData = {
                crypto: [
                    {
                        title: 'Bitcoin Reaches New All-Time High',
                        image: 'https://via.placeholder.com/800x400?text=Bitcoin+News',
                        text: 'Bitcoin has reached a new all-time high as institutional investors continue to show interest in cryptocurrency.'
                    },
                    {
                        title: 'Ethereum 2.0 Development Update',
                        image: 'https://via.placeholder.com/800x400?text=Ethereum+News',
                        text: 'The Ethereum network is preparing for its biggest upgrade yet with the transition to Proof of Stake.'
                    }
                ],
                programming: [
                    {
                        title: 'New JavaScript Features in 2024',
                        image: 'https://via.placeholder.com/800x400?text=JavaScript+News',
                        text: 'ECMAScript 2024 brings exciting new features to JavaScript developers.'
                    },
                    {
                        title: 'Python Remains Most Popular Language',
                        image: 'https://via.placeholder.com/800x400?text=Python+News',
                        text: 'Python continues to dominate programming language rankings in 2024.'
                    }
                ],
                tech: [
                    {
                        title: 'AI Breakthroughs in 2024',
                        image: 'https://via.placeholder.com/800x400?text=AI+News',
                        text: 'New AI models show unprecedented capabilities in natural language processing and image generation.'
                    },
                    {
                        title: 'Quantum Computing Milestone',
                        image: 'https://via.placeholder.com/800x400?text=Quantum+News',
                        text: 'Scientists achieve quantum supremacy in new groundbreaking experiment.'
                    }
                ]
            };

            newsData[category].forEach(item => {
                const articleElement = createArticleElement(item);
                newsContainer.appendChild(articleElement);
            });
        }

        function createArticleElement(article) {
            const div = document.createElement('div');
            div.className = 'news-article';
            div.innerHTML = `
                <h3>${article.title}</h3>
                <img src="${article.image}" alt="${article.title}">
                <p>${article.text}</p>
            `;
            return div;
        }

        // Обработка категорий новостей
        document.querySelectorAll('.category-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.category-button').forEach(btn => 
                    btn.classList.remove('active'));
                this.classList.add('active');
                loadNews(this.dataset.category);
            });
        });

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            tg.ready();
        });
    </script>
</body>
</html>
